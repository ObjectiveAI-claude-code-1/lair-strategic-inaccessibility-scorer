# Implementation Plan: lair-strategic-inaccessibility-scorer

## Overview

This plan describes the implementation of a scalar function that evaluates how difficult it would be for heroes, government agents, and do-gooders to locate and assault a potential evil lair location. Returns a score from 0 (trivially accessible) to 1 (virtually impregnable).

---

## 1. Input Schema Structure

```json
{
  "type": "object",
  "description": "Input for evaluating the strategic inaccessibility of a potential evil lair location",
  "properties": {
    "location": {
      "anyOf": [
        {
          "type": "string",
          "description": "A text description of the potential lair location, including geographic features, terrain, structures, and environmental conditions"
        },
        {
          "type": "image",
          "description": "Satellite imagery, photographs, architectural plans, or visual representations of the location"
        },
        {
          "type": "video",
          "description": "Aerial surveys, reconnaissance footage, or walkthroughs of the location"
        }
      ]
    },
    "villain_profile": {
      "type": "string",
      "description": "Optional context about the villain's operational style, resource level, known enemies, and aesthetic preferences that may influence the evaluation"
    }
  },
  "required": ["location"]
}
```

### Field Descriptions

- **location** (required): The primary input describing the potential lair site. Can be:
  - Text: Written description (e.g., "An abandoned salt mine beneath the Atacama Desert, accessible only via a 3-kilometer vertical shaft")
  - Image: Satellite imagery, photos, or architectural plans
  - Video: Aerial surveys or reconnaissance footage

- **villain_profile** (optional): Contextual information about the villain to help interpret what "inaccessible" means for their specific situation. Examples: "A reclusive cyber-villain hunted by NATO intelligence agencies" or "A charismatic cult leader with limited resources but many loyal followers."

---

## 2. Input Maps

**No input maps are needed.** 

The function evaluates a single location against 16 independent criteria. All tasks receive the same location input and optional villain_profile context. There is no need to iterate over multiple items or create mapped task execution.

---

## 3. Function Definition Structure

```json
{
  "type": "scalar.function",
  "description": "Evaluate how difficult it would be for heroes, government agents, and do-gooders to locate and assault a potential evil lair location. Returns a score from 0 (trivially accessible) to 1 (virtually impregnable). Evaluates four dimensions: geographic remoteness, concealment potential, defensive perimeter, and counter-intelligence value.",
  "input_schema": { ... },
  "tasks": [
    // 16 vector.completion tasks organized into 4 pillars
    // Each task produces a binary HIGH/LOW score
    // Tasks are averaged within pillars, then pillars are equally weighted
  ]
}
```

### Task Architecture

- **16 total tasks** organized into **4 pillars** (4 tasks each)
- Each pillar contributes **25%** to the final score
- Each task uses **binary HIGH/LOW responses** for clarity
- Final score computed as: `0.25 * (pillar_1_avg) + 0.25 * (pillar_2_avg) + 0.25 * (pillar_3_avg) + 0.25 * (pillar_4_avg)`

### Pillar Organization

| Pillar | Weight | Tasks |
|--------|--------|-------|
| I. Geographic Remoteness | 25% | 1.1, 1.2, 1.3, 1.4 |
| II. Concealment Potential | 25% | 2.1, 2.2, 2.3, 2.4 |
| III. Defensive Perimeter | 25% | 3.1, 3.2, 3.3, 3.4 |
| IV. Counter-Intelligence Value | 25% | 4.1, 4.2, 4.3, 4.4 |

---

## 4. Task Definitions

### Pillar I: Geographic Remoteness

#### Task 1.1: Distance from Population Centers
- **Type**: `vector.completion`
- **System prompt**: Strategic analyst evaluating distance from civilization, law enforcement response times, proximity to military installations
- **User prompt**: Combines location description with optional villain_profile context
- **Responses**: 
  - HIGH: Location is extremely remote, response forces hours/days away
  - LOW: Location within reasonable reach, response within hours
- **Output**: `output['scores'][0]` (HIGH score = 1.0)

#### Task 1.2: Natural Barrier Quality
- **Type**: `vector.completion`
- **System prompt**: Evaluate natural barriers (oceans, mountains, deserts, jungle, ice)
- **Responses**:
  - HIGH: Formidable barriers requiring specialized equipment
  - LOW: Relatively traversable terrain
- **Output**: `output['scores'][0]`

#### Task 1.3: Transportation Infrastructure Absence
- **Type**: `vector.completion`
- **System prompt**: Evaluate absence of roads, airports, ports
- **Responses**:
  - HIGH: Minimal/no infrastructure, specialized access required
  - LOW: Adequate infrastructure exists
- **Output**: `output['scores'][0]`

#### Task 1.4: Environmental Hostility
- **Type**: `vector.completion`
- **System prompt**: Evaluate inhospitable conditions (extreme temps, altitude, toxicity)
- **Responses**:
  - HIGH: Extremely hostile, impairs operations significantly
  - LOW: Relatively benign conditions
- **Output**: `output['scores'][0]`

### Pillar II: Concealment Potential

#### Task 2.1: Natural Camouflage Opportunities
- **Type**: `vector.completion`
- **System prompt**: Evaluate natural concealment (caves, underwater, underground, canopy)
- **Responses**:
  - HIGH: Excellent natural concealment features
  - LOW: Exposed and visible location
- **Output**: `output['scores'][0]`

#### Task 2.2: Cover Story Plausibility
- **Type**: `vector.completion`
- **System prompt**: Evaluate whether visible structures could pose as legitimate operations
- **Responses**:
  - HIGH: Highly plausible cover available
  - LOW: Difficult to establish credible cover
- **Output**: `output['scores'][0]`

#### Task 2.3: Surveillance Resistance
- **Type**: `vector.completion`
- **System prompt**: Evaluate resistance to satellite/aerial reconnaissance
- **Responses**:
  - HIGH: Highly resistant (cloud cover, terrain, airspace restrictions)
  - LOW: Vulnerable to surveillance
- **Output**: `output['scores'][0]`

#### Task 2.4: Signature Minimization Potential
- **Type**: `vector.completion`
- **System prompt**: Evaluate ability to mask thermal, EM, acoustic, chemical signatures
- **Responses**:
  - HIGH: Excellent signature masking potential
  - LOW: Poor signature masking potential
- **Output**: `output['scores'][0]`

### Pillar III: Defensive Perimeter

#### Task 3.1: Natural Chokepoints and Kill Zones
- **Type**: `vector.completion`
- **System prompt**: Evaluate terrain chokepoints funneling attackers
- **Responses**:
  - HIGH: Excellent natural chokepoints
  - LOW: No significant chokepoints
- **Output**: `output['scores'][0]`

#### Task 3.2: Defender Terrain Advantage
- **Type**: `vector.completion`
- **System prompt**: Evaluate high ground, natural fortifications, cover
- **Responses**:
  - HIGH: Strong defender advantage
  - LOW: Minimal defender advantage
- **Output**: `output['scores'][0]`

#### Task 3.3: Escape Route Availability
- **Type**: `vector.completion`
- **System prompt**: Evaluate concealed evacuation routes
- **Responses**:
  - HIGH: Excellent escape options
  - LOW: Limited escape options
- **Output**: `output['scores'][0]`

#### Task 3.4: Defensive Installation Capacity
- **Type**: `vector.completion`
- **System prompt**: Evaluate capacity for layered defenses
- **Responses**:
  - HIGH: Excellent capacity for installations
  - LOW: Limited capacity
- **Output**: `output['scores'][0]`

### Pillar IV: Counter-Intelligence Value

#### Task 4.1: Legitimate Traffic Proximity
- **Type**: `vector.completion`
- **System prompt**: Evaluate proximity to shipping lanes, air corridors for cover
- **Responses**:
  - HIGH: Excellent traffic cover
  - LOW: Poor traffic cover
- **Output**: `output['scores'][0]`

#### Task 4.2: Communication Infrastructure Access
- **Type**: `vector.completion`
- **System prompt**: Evaluate access to comm networks for monitoring and connectivity
- **Responses**:
  - HIGH: Excellent communication access
  - LOW: Poor communication access
- **Output**: `output['scores'][0]`

#### Task 4.3: Logistics Blending Capability
- **Type**: `vector.completion`
- **System prompt**: Evaluate ability to blend supplies with legitimate commerce
- **Responses**:
  - HIGH: Excellent logistics blending
  - LOW: Poor logistics blending
- **Output**: `output['scores'][0]`

#### Task 4.4: Local Discretion Environment
- **Type**: `vector.completion`
- **System prompt**: Evaluate whether unusual activity goes unreported
- **Responses**:
  - HIGH: Excellent discretion environment
  - LOW: Poor discretion environment
- **Output**: `output['scores'][0]`

---

## 5. Expressions to Write

### User Content Expressions

Each task needs a user content expression that combines the location with optional villain_profile:

```starlark
# For text location input
"Evaluate this potential lair location:\n\n" + input['location'] + ("\n\nVillain Profile: " + input['villain_profile'] if 'villain_profile' in input and input['villain_profile'] else "")
```

Or using a conditional pattern:
```starlark
"Evaluate this potential lair location:\n\n" + str(input['location'])
```

For multimodal support (text/image/video), the user content should be an array:
```json
{
  "role": "user",
  "content": [
    {
      "type": "text",
      "text": "Evaluate this potential lair location for [SPECIFIC CRITERION]:"
    },
    {
      "type": "text",
      "text": { "$starlark": "input['location']" }
    },
    {
      "type": "text",
      "text": { "$starlark": "'Villain Profile: ' + input['villain_profile'] if 'villain_profile' in input and input['villain_profile'] else ''" }
    }
  ]
}
```

### Task Output Expressions

Each task uses binary scoring:
```starlark
output['scores'][0]
```

This extracts the probability assigned to the HIGH response (first response option).

### Final Score Aggregation

The function will need to aggregate the 16 task outputs. Since ObjectiveAI scalar functions automatically average all task outputs, we need to ensure equal pillar weighting by having 4 tasks per pillar (which naturally produces equal weighting when averaged).

Alternative: If explicit weighting is needed, a final aggregation task could be added, but the 4-tasks-per-pillar structure with automatic averaging should produce the correct result.

---

## 6. Test Inputs

### Test Case 1: Low Score (~0.1-0.2) - Trivially Accessible
```json
{
  "location": "A warehouse in downtown Manhattan, New York City. Located on a busy commercial street with 24/7 foot traffic. Multiple entrances facing public sidewalks. Surrounded by office buildings with clear sightlines. NYPD precinct three blocks away. JFK and LaGuardia airports within 30 minutes. Subway station directly underneath."
}
```
**Expected**: Very low score. No remoteness, no concealment, no defensive advantages, but good counter-intelligence (ironic).

### Test Case 2: Low-Medium Score (~0.3-0.4) - Marginally Defensible
```json
{
  "location": "An abandoned factory complex in rural Pennsylvania, about 45 minutes from Pittsburgh. The property includes several large buildings surrounded by chain-link fence. Access via a single county road. Nearest neighbors about 2 miles away. Some wooded areas on the property provide partial concealment from aerial view."
}
```
**Expected**: Modest isolation and some concealment, but limited natural barriers and defensive features.

### Test Case 3: Medium Score (~0.5) - Moderately Inaccessible
```json
{
  "location": "A decommissioned Cold War bunker complex in the mountains of Montenegro. Located at 1,800 meters elevation, accessible only by a winding mountain road that becomes impassable in winter. The bunker extends deep into the mountain with multiple underground levels. The nearest town is 40 kilometers away. Local population sparse and traditionally suspicious of outsiders.",
  "villain_profile": "A former intelligence officer with significant financial resources and connections to local organized crime networks."
}
```
**Expected**: Good remoteness, excellent concealment, decent defensive position, moderate counter-intelligence value.

### Test Case 4: High Score (~0.7-0.8) - Highly Inaccessible
```json
{
  "location": "An underwater habitat anchored to the seafloor at 200 meters depth, 150 kilometers off the coast of Madagascar in international waters. Access only via submarine. The facility is positioned near an active hydrothermal vent field, which masks thermal signatures. A legitimate deep-sea mining operation serves as cover. Supply runs blend with regular commercial shipping traffic through the Mozambique Channel.",
  "villain_profile": "A tech billionaire with a private submarine fleet and connections to several national governments."
}
```
**Expected**: Excellent across all dimensions except possibly communication infrastructure.

### Test Case 5: Very High Score (~0.85-0.95) - Virtually Impregnable
```json
{
  "location": "A research station constructed inside a dormant volcanic caldera in the interior of Antarctica, 800 kilometers from the nearest coast. The facility is built into the rock beneath the ice, with the only surface structure disguised as a climate research station (legitimately registered and staffed). Access is possible only 3 months per year via specially equipped aircraft. The extreme cold (-60Â°C average) requires specialized survival equipment. Multiple underground tunnels connect to emergency shelters with cached supplies. Satellite coverage is limited due to polar orbit gaps. The location is technically under international treaty, complicating military intervention."
}
```
**Expected**: Near-maximum score. Extreme remoteness, excellent concealment, strong defensive position, decent counter-intelligence despite isolation.

### Test Case 6: Edge Case - Orbital Location
```json
{
  "location": "A private space station in low Earth orbit, officially registered as a commercial satellite manufacturing facility. The station maintains multiple escape pods and has connections to several ground stations worldwide. Resupply via commercial rocket launches from multiple countries."
}
```
**Expected**: Maximum remoteness and concealment, but unique considerations for defense and counter-intelligence.

### Test Case 7: Edge Case - Urban Concealment Strategy
```json
{
  "location": "A network of interconnected basements beneath a historic district in Prague, accessed through multiple legitimate businesses (a bookshop, a wine bar, and an antique dealer). The tunnels date from medieval times and are not on any modern maps. The neighborhood is popular with tourists, providing constant cover for unusual visitors. Local authorities are known to be... accommodating.",
  "villain_profile": "An old-world crime family with deep roots in European politics and finance."
}
```
**Expected**: Low remoteness but excellent concealment and counter-intelligence. Tests the function's ability to recognize alternative strategic approaches.

### Test Case 8: Image Input
```json
{
  "location": "[IMAGE: Satellite photo of a remote island in the Pacific with volcanic terrain, dense jungle, and a small harbor on one side]"
}
```
**Expected**: Function should evaluate visual features for all criteria.

### Test Case 9: Minimal Description
```json
{
  "location": "A cave"
}
```
**Expected**: Function should handle vague input gracefully, likely producing mid-range scores due to uncertainty.

### Test Case 10: Contradictory Features
```json
{
  "location": "A highly visible glass skyscraper in downtown Dubai, but with 30 underground levels that extend beneath adjacent properties. The building is owned through an impenetrable shell company structure. A private helipad and submarine dock provide alternative access. The building's systems can flood lower levels with seawater on command."
}
```
**Expected**: Mixed scores - poor concealment for surface structure but excellent for underground portions; tests nuanced evaluation.

---

## 7. Implementation Notes

### Response Format
Each task uses exactly 2 responses in HIGH/LOW format:
- Response 0: HIGH - favorable for inaccessibility
- Response 1: LOW - unfavorable for inaccessibility

This ensures `output['scores'][0]` captures the probability of the favorable outcome.

### System Prompt Structure
Each system prompt should:
1. Establish the role (strategic analyst evaluating lair locations)
2. State the specific criterion being evaluated
3. List key considerations
4. Request a binary HIGH/LOW judgment

### Villain Profile Integration
The optional villain_profile should be appended to user content when present but should not change the fundamental evaluation criteria. It provides context for edge cases (e.g., a flying superhero threat makes aerial inaccessibility more important).

### Multimodal Handling
User content should be structured as an array to properly handle text, image, and video inputs while maintaining consistent prompting across modalities.

---

## 8. Summary

| Component | Count/Detail |
|-----------|--------------|
| Input fields | 2 (location required, villain_profile optional) |
| Input types | Text, Image, Video (anyOf) |
| Input maps | None needed |
| Total tasks | 16 |
| Task type | vector.completion (all) |
| Responses per task | 2 (binary HIGH/LOW) |
| Pillars | 4 (equally weighted at 25% each) |
| Output range | 0.0 to 1.0 |
| Test cases | 10 (covering score range, edge cases, modalities) |
